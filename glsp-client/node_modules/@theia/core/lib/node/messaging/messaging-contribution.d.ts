/// <reference types="node" />
import * as http from 'http';
import * as https from 'https';
import { Socket } from 'socket.io';
import { interfaces, Container } from 'inversify';
import { MessageConnection } from 'vscode-ws-jsonrpc';
import { IConnection } from 'vscode-ws-jsonrpc/lib/server/connection';
import { ContributionProvider } from '../../common';
import { WebSocketChannel } from '../../common/messaging/web-socket-channel';
import { BackendApplicationContribution } from '../backend-application';
import { MessagingService } from './messaging-service';
import { WsRequestValidator } from '../ws-request-validators';
import { MessagingListener } from './messaging-listeners';
export declare const MessagingContainer: unique symbol;
export declare class MessagingContribution implements BackendApplicationContribution, MessagingService {
    protected readonly container: interfaces.Container;
    protected readonly connectionModules: ContributionProvider<interfaces.ContainerModule>;
    protected readonly contributions: ContributionProvider<MessagingService.Contribution>;
    protected readonly wsRequestValidator: WsRequestValidator;
    protected readonly messagingListener: MessagingListener;
    protected readonly wsHandlers: MessagingContribution.ConnectionHandlers<Socket<import("socket.io/dist/typed-events").DefaultEventsMap, import("socket.io/dist/typed-events").DefaultEventsMap, import("socket.io/dist/typed-events").DefaultEventsMap, any>>;
    protected readonly channelHandlers: MessagingContribution.ConnectionHandlers<WebSocketChannel>;
    protected init(): void;
    listen(spec: string, callback: (params: MessagingService.PathParams, connection: MessageConnection) => void): void;
    forward(spec: string, callback: (params: MessagingService.PathParams, connection: IConnection) => void): void;
    wsChannel(spec: string, callback: (params: MessagingService.PathParams, channel: WebSocketChannel) => void): void;
    ws(spec: string, callback: (params: MessagingService.PathParams, socket: Socket) => void): void;
    protected checkAliveTimeout: number;
    protected maxHttpBufferSize: number;
    onStart(server: http.Server | https.Server): void;
    protected handleConnection(socket: Socket): void;
    protected allowConnect(request: http.IncomingMessage): Promise<boolean>;
    protected handleChannels(socket: Socket): void;
    protected createSocketContainer(socket: Socket): Container;
    protected getConnectionChannelHandlers(socket: Socket): MessagingContribution.ConnectionHandlers<WebSocketChannel>;
    protected createChannel(id: number, socket: Socket): WebSocketChannel;
}
export declare namespace MessagingContribution {
    class ConnectionHandlers<T> {
        protected readonly parent?: ConnectionHandlers<T> | undefined;
        protected readonly handlers: ((path: string, connection: T) => string | false)[];
        constructor(parent?: ConnectionHandlers<T> | undefined);
        push(spec: string, callback: (params: MessagingService.PathParams, connection: T) => void): void;
        route(path: string, connection: T): string | false;
    }
}
//# sourceMappingURL=messaging-contribution.d.ts.map